# YgameEngine Wiki 文档

## 项目概述

YgameEngine 是一个基于 Godot 引擎的游戏开发工具库，用于加速游戏制作流程并提供个人常用功能的封装。该引擎提供了一套完整的工具类和模块，涵盖调试、场景管理、网络通信、数据存储、角色系统等多个方面。
请注意 插件文件夹名称有问题
## 基本信息

- **项目名称**: YgameEngine
- **版本**: 10.0
- **官网**: https://0dcszgip.cn-nb1.rainapp.top/YgameEngine.html
- **QQ群**: 696526224
- **文档**: https://dcn9lhqj5lht.feishu.cn/wiki/BCsQwCUYkiNfJikYhJIcZXOsnGf

## 安装与使用

### 安装步骤

1. 下载 YgameEngine 插件
2. 将插件放置在 Godot 项目的 `addons` 目录下
3. 在 Godot 编辑器中启用插件

### 启用插件

启用插件后，系统会自动将 `引擎.gd` 挂载至项目的全局自动加载，您可以通过 `引擎.xxx` 来调用各种功能。

## 核心模块

### 1. 调试模块 (引擎.调试)

提供调试模式下的增强打印功能，支持带颜色的输出和格式化显示。

```gdscript
# 基本打印
引擎.调试.打印("重要信息")

# 带注释的打印
引擎.调试.注释打印("玩家位置", player.position)

# 打印字典
引擎.调试.打印字典(player.stats, "玩家属性")

# 打印数组
引擎.调试.打印数组(items_list, "物品列表")

# 检查调试模式
if 引擎.调试.取调试模式():
	print("当前处于调试模式")
```

### 2. 场景管理 (引擎.场景)

提供场景切换、管理和控制的功能。

```gdscript
# 切换场景
引擎.场景.切换场景("res://scenes/gameplay.tscn")

# 获取当前场景
var 当前场景 = 引擎.场景.取当前场景()

# 等待指定时间
await 引擎.场景.等待(2.0)

# 销毁当前场景
引擎.场景.销毁当前场景()

# 播放音效
引擎.场景.播放音效(load("res://audio/sfx.wav"))

# 播放音乐
引擎.场景.播放音乐(load("res://audio/bgm.mp3"))

# 设置音量
引擎.场景.设置背景声音大小(0.5)
引擎.场景.设置音效声音大小(0.5)
```

### 3. 网络通信 (引擎.网络)

提供基于 UDP 的网络通信功能，包括客户端和服务端。

#### UDP 客户端

```gdscript
# 创建客户端
var 客户端 = 引擎.网络.UDP_创建客户端()

# 连接服务器
客户端.UDP_连接("127.0.0.1", 8777)

# 发送数据
客户端.UDP_发送数据({"消息": "Hello Server"}, "utf8")

# 处理数据
客户端.UDP_处理数据({
	"客户端收到消息": func(数据):
		print("收到服务器消息:", 数据)
})
```

#### UDP 服务端

```gdscript
# 创建服务端
var 服务端 = 引擎.网络.UDP_创建服务端()

# 启动监听
服务端.UDP_启动服务(25555)

# 处理数据
服务端.UDP_处理数据({
	"客户端进入": func(客户端, ip, 端口):
		print("新客户端进入:", ip, ":", 端口)
	"服务端收到消息": func(客户端, 数据, ip, 端口):
		print("收到消息:", 数据)
		# 广播给所有客户端
		服务端.UDP_广播数据("消息已收到")
})
```

#### 网页请求

```gdscript
# GET 请求
var 结果 = await 引擎.网络.网页请求_GET("https://api.example.com/data")

# POST 请求
var 结果 = await 引擎.网络.网页请求_POST("https://api.example.com/submit", {"key": "value"})

# 下载文件
引擎.网络.网页请求_下载文件("https://example.com/file.zip", "user://download.zip", {
	"下载状态": func(已下载, 总大小):
		print("下载进度:", 已下载, "/", 总大小)
	"完成状态": func(状态):
		print("下载完成:", 状态)
})
```

### 4. 背包系统 (引擎.背包)

提供角色背包的管理功能，支持道具的添加、删除、查询等操作。

```gdscript
# 创建背包
var 背包 = 引擎.背包

# 添加道具
背包.添加道具("sword_001", 1, true)

# 减少道具
背包.减少道具("potion", 2)

# 获取道具数量
var 数量 = 背包.获取道具数量("potion")

# 获取道具索引
var 索引 = 背包.获取道具索引("sword_001")

# 背包排序
背包.背包排序(道具数据库, true)
```

### 5. 数据库系统 (引擎.数据库)

提供多种数据库的读取和管理功能。

#### 道具数据库

```gdscript
# 获取数据库
var 道具库 = 引擎.数据库.道具数据库.new().获取数据库()

# 获取道具信息
var 名称 = 道具库.获取名称("sword_001")
var 描述 = 道具库.获取描述("sword_001")
var 价格 = 道具库.获取价格("potion")
```

#### NPC 数据库

```gdscript
# 获取数据库
var NPC库 = 引擎.数据库.NPC数据库.new().获取数据库()

# 获取NPC信息
var 名称 = NPC库.获取名称("npc_001")
var 等级 = NPC库.获取等级("npc_001")
var 属性 = NPC库.获取属性列表("npc_001")
```

#### 技能数据库

```gdscript
# 获取数据库
var 技能库 = 引擎.数据库.技能数据库.new().获取数据库()

# 获取技能信息
var 名称 = 技能库.获取名称("skill_001")
var 伤害 = 技能库.获取伤害("skill_001")
var 消耗 = 技能库.获取消耗("skill_001")
```

### 6. 装备系统 (引擎.装备)

提供装备的穿戴、卸下和属性统计功能。

```gdscript
# 创建装备系统
var 装备 = 引擎.装备类.装备.new()

# 创建装备槽
装备.创建装备槽("武器")
装备.创建装备槽("防具")

# 定制装备规则
装备.定制规则("武器", func(道具ID):
	return {"武器": [道具ID]}
)

# 穿戴装备
	装备.穿戴装备("sword_001", 道具库, 背包)

# 获取属性统计
var 属性 = 装备.获取统计属性(道具库)
```

### 7. 角色属性系统 (引擎.角色属性)

提供角色属性的管理、计算和升级功能。

```gdscript
# 创建角色属性系统
var 属性系统 = 引擎.角色属性类.职业与属性.new("战士")

# 配置属性规则
属性系统.配置属性规则({
	"力量": {
		"通用": 1.0,
		"战士": 1.5
	}
})

# 配置基础属性
属性系统.配置基础属性({
	"战士": {
		"生命值": 100,
		"攻击力": 10
	}
})

# 设置属性
属性系统.属性数值设置("力量", 10)

# 增加属性
属性系统.属性数值增加("力量", 1)

# 获取属性
var 力量 = 属性系统.属性数值获取("力量")

# 计算最终属性
var 最终属性 = 属性系统.计算属性效果(true)
```

### 8. 角色经验系统 (引擎.角色经验)

提供角色等级和经验的管理功能。

```gdscript
# 创建经验系统
var 经验系统 = 引擎.角色经验类.等级经验系统.new(99)

# 配置经验公式
经验系统.配置经验公式(func(等级):
	return 等级 * 100
)

# 配置升级奖励
经验系统.配置升级奖励(func(新等级, 旧等级):
	print("升级到等级", 新等级)
))

# 增加经验
经验系统.经验值增加(150)

# 获取等级
var 等级 = 经验系统.获取当前等级()

# 获取经验
var 经验 = 经验系统.获取累计经验值()
```

### 9. 生命魔法系统 (引擎.生命魔法)

提供生命值和魔法值的管理功能。

```gdscript
# 创建生命魔法系统
var 生命魔法 = 引擎.生命魔法类.生命魔法.new()

# 设置生命值
生命魔法.设置上限生命值(100, true)  # 设置上限并恢复满血
生命魔法.设置当前生命值(80)

# 设置魔法值
生命魔法.设置上限魔法值(50, true)  # 设置上限并恢复满魔
生命魔法.设置当前魔法值(30)

# 获取生命值
var 当前生命 = 生命魔法.获取当前生命值()
var 上限生命 = 生命魔法.获取上限生命值()

# 恢复生命
生命魔法.生命值恢复(20)
生命魔法.魔法值恢复(10)
```

### 10. 怪物系统 (引擎.怪物)

提供怪物数据的管理和操作功能。

```gdscript
# 创建怪物
var 怪物 = 引擎.怪物类.怪物.new("monster_001", 1)

# 获取怪物信息
var 名称 = 怪物.数据.获取名称()
var 等级 = 怪物.数据.获取等级()
var 属性 = 怪物.数据.获取属性列表()

# 获取生命值
var 当前生命 = 怪物.状态.获取当前生命值()
var 上限生命 = 怪物.状态.获取上限生命值()
```

### 11. 舞台系统 (引擎.舞台)

提供战斗舞台的管理功能，支持1v1对战逻辑。

```gdscript
# 创建战斗舞台
var 舞台 = 引擎.舞台类.放置对战.new(我方数据, 敌方数据, 1.0)

# 配置战斗数据
var 我方数据 = {
	"id": 1001,
	"速度": 1.5,
	"可攻击": true,
	"生命值": 100,
	"攻击力": 10,
	"距离": 1.0
}

var 敌方数据 = {
	"id": 2001,
	"速度": 1.2,
	"可攻击": true,
	"生命值": 80,
	"攻击力": 8,
	"距离": 1.0
}

# 设置攻击回调
舞台.我方攻击回调 = func(我方, 敌方):
	敌方.生命值 -= 我方.攻击力
	print("我方攻击，敌方剩余生命:", 敌方.生命值)

舞台.敌方攻击回调 = func(敌方, 我方):
	我方.生命值 -= 敌方.攻击力
	print("敌方攻击，我方剩余生命:", 我方.生命值)

# 设置胜负回调
舞台.胜利回调 = func():
	print("我方胜利！")

舞台.失败回调 = func():
	print("敌方胜利！")
```

### 12. 增益系统 (引擎.增益)

提供增益效果的管理功能，支持时间型和次数型增益。

```gdscript
# 创建增益系统
var 增益 = 引擎.增益类.增益.new()

# 添加增益
增益.添加增益("buff_001")

# 更新时间增益
增益.更新时间增益(1.0)

# 更新次数增益
增益.更新次数增益(1)

# 计算总增益效果
var 总效果 = 增益.计算总增益效果()

# 检查增益
if 增益.检查增益("buff_001"):
	print("拥有增益效果")
```

### 13. 技能系统 (引擎.技能)

提供技能的学习和管理功能。

```gdscript
# 创建技能系统
var 技能 = 引擎.技能类.基础技能.new()

# 学习技能
技能.学习技能("skill_001")

# 忘记技能
技能.忘记技能("skill_001")

# 获取已学习技能
var 已学习 = 技能.获取已学习技能列表()

# 计算被动技能加成
var 被动加成 = 技能.计算被动技能总加成()
```

### 7. 角色属性系统 (引擎.角色属性)

提供角色属性的管理、计算和升级功能。

```gdscript
# 创建角色属性系统
var 属性系统 = 引擎.角色属性类.职业与属性.new("战士")

# 配置属性规则
属性系统.配置属性规则({
	"力量": {
		"通用": 1.0,
		"战士": 1.5
	}
})

# 配置基础属性
属性系统.配置基础属性({
	"战士": {
		"生命值": 100,
		"攻击力": 10
	}
})

# 设置属性
属性系统.属性数值设置("力量", 10)

# 增加属性
属性系统.属性数值增加("力量", 1)

# 获取属性
var 力量 = 属性系统.属性数值获取("力量")

# 计算最终属性
var 最终属性 = 属性系统.计算属性效果(true)
```

### 8. 角色经验系统 (引擎.角色经验)

提供角色等级和经验的管理功能。

```gdscript
# 创建经验系统
var 经验系统 = 引擎.角色经验类.等级经验系统.new(99)

# 配置经验公式
经验系统.配置经验公式(func(等级):
	return 等级 * 100
)

# 配置升级奖励
经验系统.配置升级奖励(func(新等级, 旧等级):
	print("升级到等级", 新等级)
))

# 增加经验
经验系统.经验值增加(150)

# 获取等级
var 等级 = 经验系统.获取当前等级()

# 获取经验
var 经验 = 经验系统.获取累计经验值()
```

### 9. 生命魔法系统 (引擎.生命魔法)

提供生命值和魔法值的管理功能。

```gdscript
# 创建生命魔法系统
var 生命魔法 = 引擎.生命魔法类.生命魔法.new()

# 设置生命值
生命魔法.设置上限生命值(100, true)  # 设置上限并恢复满血
生命魔法.设置当前生命值(80)

# 设置魔法值
生命魔法.设置上限魔法值(50, true)  # 设置上限并恢复满魔
生命魔法.设置当前魔法值(30)

# 获取生命值
var 当前生命 = 生命魔法.获取当前生命值()
var 上限生命 = 生命魔法.获取上限生命值()

# 恢复生命
生命魔法.生命值恢复(20)
生命魔法.魔法值恢复(10)
```

### 10. 怪物系统 (引擎.怪物)

提供怪物数据的管理和操作功能。

```gdscript
# 创建怪物
var 怪物 = 引擎.怪物类.怪物.new("monster_001", 1)

# 获取怪物信息
var 名称 = 怪物.数据.获取名称()
var 等级 = 怪物.数据.获取等级()
var 属性 = 怪物.数据.获取属性列表()

# 获取生命值
var 当前生命 = 怪物.状态.获取当前生命值()
var 上限生命 = 怪物.状态.获取上限生命值()
```

### 11. 舞台系统 (引擎.舞台)

提供战斗舞台的管理功能，支持1v1对战逻辑。

```gdscript
# 创建战斗舞台
var 舞台 = 引擎.舞台类.放置对战.new(我方数据, 敌方数据, 1.0)

# 配置战斗数据
var 我方数据 = {
	"id": 1001,
	"速度": 1.5,
	"可攻击": true,
	"生命值": 100,
	"攻击力": 10,
	"距离": 1.0
}

var 敌方数据 = {
	"id": 2001,
	"速度": 1.2,
	"可攻击": true,
	"生命值": 80,
	"攻击力": 8,
	"距离": 1.0
}

# 设置攻击回调
舞台.我方攻击回调 = func(我方, 敌方):
	敌方.生命值 -= 我方.攻击力
	print("我方攻击，敌方剩余生命:", 敌方.生命值)

舞台.敌方攻击回调 = func(敌方, 我方):
	我方.生命值 -= 敌方.攻击力
	print("敌方攻击，我方剩余生命:", 我方.生命值)

# 设置胜负回调
舞台.胜利回调 = func():
	print("我方胜利！")

舞台.失败回调 = func():
	print("敌方胜利！")
```

### 12. 增益系统 (引擎.增益)

提供增益效果的管理功能，支持时间型和次数型增益。

```gdscript
# 创建增益系统
var 增益 = 引擎.增益类.增益.new()

# 添加增益
增益.添加增益("buff_001")

# 更新时间增益
增益.更新时间增益(1.0)

# 更新次数增益
增益.更新次数增益(1)

# 计算总增益效果
var 总效果 = 增益.计算总增益效果()

# 检查增益
if 增益.检查增益("buff_001"):
	print("拥有增益效果")
```

### 13. 技能系统 (引擎.技能)

提供技能的学习和管理功能。

```gdscript
# 创建技能系统
var 技能 = 引擎.技能类.基础技能.new()

# 学习技能
技能.学习技能("skill_001")

# 忘记技能
技能.忘记技能("skill_001")

# 获取已学习技能
var 已学习 = 技能.获取已学习技能列表()

# 计算被动技能加成
var 被动加成 = 技能.计算被动技能总加成()
```

## 弱网系统

提供简化版的网络服务端和客户端实现，包含账号系统、聊天系统、排行榜等功能。

### 弱网服务端

```gdscript
# 创建服务端
var 弱网服务端 = 引擎.弱网.创建弱网服务端()

# 启动监听
弱网服务端.启动监听(25555)

# 处理数据
弱网服务端.处理数据({
	"客户端进入": func(客户端, ip, 端口):
		print("客户端进入:", ip, ":", 端口)
	"服务端收到消息": func(客户端, 数据, ip, 端口):
		print("收到消息:", 数据)
})
```

### 弱网客户端

```gdscript
# 创建客户端
var 弱网客户端 = 引擎.弱网.创建弱网客户端()

# 连接服务端
弱网客户端.连接("127.0.0.1", 25555)

# 发送数据
弱网客户端.发送数据({"类型": "聊天请求", "标记": "公共频道", "文本": "Hello"})

# 处理数据
弱网客户端.处理数据({
	"客户端收到消息": func(数据):
		print("收到消息:", 数据)
})
```

## 工具函数

### 1. 数学工具 (引擎.数学)

```gdscript
# 随机数生成
var 随机整数 = 引擎.数学.随机_取范围整数(1, 10)
var 随机浮点数 = 引擎.数学.随机_取0到1的浮点数()

# 权重选择
var 权重表 = [["物品A", 10], ["物品B", 5], ["物品C", 1]]
var 选中 = 引擎.数学.随机_权重选择(权重表)

# 字典操作
var 合并 = 引擎.数学.字典叠加(字典A, 字典B)
var 填充 = 引擎.数学.字典填充更新(目标字典, 源字典)
```

### 2. 字符串工具 (引擎.字符串)

```gdscript
# JSON 操作
var json文本 = 引擎.字符串.Json_到字符串(数据字典)
var 数据字典 = 引擎.字符串.Json_到数据(json文本)

# 随机码生成
var 随机码 = 引擎.字符串.获取不重复随机码()

# 正则匹配
var 匹配结果 = 引擎.字符串.正则匹配(文本, 模式)
```

### 3. 时间工具 (引擎.时间)

```gdscript
# 获取时间戳
var 时间戳 = 引擎.时间.取当前时间戳()

# 时间格式化
var 格式化时间 = 引擎.时间.格式化时间(时间戳)
```

### 4. 文件工具 (引擎.文件)

```gdscript
# 读取文件
var 文本 = 引擎.文件.读取文件到文本("res://data.txt")
var 变量 = 引擎.文件.读取文件到变量("res://data.json")

# 保存文件
引擎.文件.保存文本到文件("内容", "res://data.txt")
引擎.文件.保存变量到文件(数据, "res://data.json")

# 文件操作
引擎.文件.删除文件("res://old.txt")
引擎.文件.复制文件("res://source.txt", "res://target.txt")
引擎.文件.移动文件("res://old.txt", "res://new.txt")

# 目录操作
引擎.文件.创建目录("res://newdir")
引擎.文件.删除目录("res://olddir")
```

### 5. 加解密工具 (引擎.加解密)

```gdscript
# 浮点数加解密
var 加密值 = 引擎.加解密.浮点数加密(100.5)
var 解密值 = 引擎.加解密.浮点数解密(加密值)

# 字符串加解密
var 加密文本 = 引擎.加解密.字符串加密("秘密信息")
var 解密文本 = 引擎.加解密.字符串解密(加密文本)

# 检查作弊
if 引擎.加解密.是否作弊:
	print("检测到作弊行为")
```

## 使用示例

### 完整的角色创建示例

```gdscript
extends Node

func _ready():
	# 创建角色
	var 角色 = {
		"背包": 引擎.背包,
		"装备": 引擎.装备类.装备.new(),
		"属性": 引擎.角色属性类.职业与属性.new("战士"),
		"经验": 引擎.角色经验类.等级经验系统.new(99),
		"生命魔法": 引擎.生命魔法类.生命魔法.new(),
		"技能": 引擎.技能类.基础技能.new(),
		"增益": 引擎.增益类.增益.new()
	}
	
	# 配置属性
	角色.属性.配置属性规则({
		"力量": {"通用": 1.0, "战士": 1.5},
		"敏捷": {"通用": 1.0, "弓箭手": 1.5}
	})
	
	# 设置基础属性
	角色.属性.配置基础属性({
		"战士": {"生命值": 100, "攻击力": 10}
	})
	
	# 学习技能
	角色.技能.学习技能("skill_001")
	
	# 获取道具
	角色.背包.添加道具("potion", 5)
	
	# 穿戴装备
	角色.装备.穿戴装备("sword_001", 道具库, 角色.背包)
	
	# 计算最终属性
	var 最终属性 = 角色.属性.计算属性效果(true)
	
	# 显示角色信息
	引擎.调试.打印("角色创建完成")
	引擎.调试.打印字典(最终属性, "最终属性")
```

## 注意事项

1. **调试模式**: 大部分调试功能只在调试模式下生效，发布版本会自动禁用
2. **数据加密**: 系统提供了数据加密功能，建议在关键数据上使用
3. **性能考虑**: 大量的打印输出可能影响性能，建议在发布版本中禁用
4. **版本兼容**: 确保使用的 Godot 版本与引擎兼容

## 更新日志

### v10.0
- 重构背包系统，支持加密存储
- 新增弱网系统，提供简化的网络服务
- 优化数据库系统，支持更多数据类型
- 增强调试功能，提供更多输出选项

## 贡献指南

如果您想为 YgameEngine 做出贡献：

1. Fork 项目仓库
2. 创建功能分支
3. 提交更改
4. 发起 Pull Request

## 许可证

本项目采用 MIT 许可证。详情请查看 LICENSE 文件。

## 联系我们

- **QQ群**: 696526224
- **官方文档**: https://dcn9lhqj5lht.feishu.cn/wiki/BCsQwCUYkiNfJikYhJIcZXOsnGf
- **问题反馈**: 请在 QQ 群中反馈问题或建议

---

**YgameEngine** - 让游戏开发更简单！
